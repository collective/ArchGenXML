<!-- ?xml version="1.0" encoding="utf-8" -->
<meta name="author" content="Jens W. Klein (aka Jensens)" />
<meta name="date" content="2004-03-03" />

<div class="document" id="archgenxml-generating-archetypes-using-uml">
<h1>ArchGenXML - generating Archetypes using UML</h1>
<table class="docinfo" frame="void" rules="none">
<tbody valign="top">
<tr><th >Author:</th>
<td>Jens W. Klein (aka Jensens)</td></tr>
<tr><th >Contact:</th>
<td><a class="first last" href="mailto:jens.klein&#64;jensquadrat.de">jens.klein&#64;jensquadrat.de</a></td></tr>
<tr><th >Date:</th>
<td>2004-03-03</td></tr>
<tr><th >Version:</th>
<td>1.1</td></tr>
<tr><th>Web site:</th><td><a href="http://sourceforge.net/projects/archetypes">http://sourceforge.net/projects/archetypes</a></td>
</tr>
<tr><th>Original URL:</th><td>cvs -z3 -d:pserver:anonymous&#64;cvs.sourceforge.net:/cvsroot/plone-docs co Developers/Archetypes</td>
</tr>
</tbody>
</table>
<div class="section" id="introduction">
<h1><a name="introduction">Introduction</a></h1>
<p>ArchGenXML is a commandline utility that generates Plone applications (products)
based on the Archetypes framework from UML models using XMI (.xmi, .zargo, .zuml) and XSD (XMLSchema) files.</p>
<p>Design your Archetypes (code for content objects in plone) offline using a UML design tool
like Poseidon or ObjectDomain. Export the UML to XMI or XSD and use ArchGenXML to generate
Phyton code for use as a Product. This new Product is available as a new item (document) type
in the Plone userinterface.</p>
<p>This time the tool is not round-trip enabled: Generated can't be back-converted into XMI.
But you can re-generate over existing code: Method bodys are kept.</p>
<p>ArchGenXML is started, programmed and maintained by 'Phil Auersperg'</p>
<p>The complete ArchGenXML manual is part of the latest 'ArchGenXML-Package'
or check it out from CVS:</p>
<pre>
cvs -d :pserver:anonymous&#64;cvs.sf.net:/cvsroot/archetypes co ArchGenXML
</pre>
</div>
<div class="section" id="uml-class-diagramm-a-brief-introduction">
<h1><a name="uml-class-diagramm-a-brief-introduction">UML class diagramm - a brief introduction</a></h1>
<p>UML - the Unified Modelling Language is a graphical language designed to describe software.</p>
<p>To attain that goal these language has got several different diagram-types defined, an (brief) example give the
<a href="http://www.oose.de/notationuml14/">OOSE</a> (german and a english pdf):</p>
<p>For ArchGenXML are from interest: the class-diagramm and it's different associations.
In future versions of ArchGenXML it may be possible to define the workflow with state diagrams.</p>
<p>With this language you're able to define object-oriented data-models.
A class is the outline of an object like a building-plan. With ArchGenXML you define this plan.
If a building is related to other building you define this with associations.</p>
</div>
<div class="section" id="getting-started">
<h1><a name="getting-started">Getting started</a></h1>
<div class="section" id="uml-tools">
<h2><a name="uml-tools">UML Tools</a></h2>
<p>ArchGenXML is tested with the XMI output from the following tools:</p>
<dl>
<dt><a href="http://www.objectdomain.com/_odR30/odR3download.html">ObjectDomain</a> (commercial, free demo for &lt;= 30 classes)</dt>
<dd>provides the possibility to export the model to XMI</dd>
<dt>Sybase <a href="http://www.sybase.com/">Powerdesigner</a> (commercial, demo download)</dt>
<dd>supports model export as XMI (XMI version 1.1)</dd>
<dt><a href="http://argouml.tigris.org/">ArgoUML</a> (free)</dt>
<dd>stores the model native as xmi + diagram information in .zargo files (zip files) (xmi version 1.0)</dd>
<dt><a href="http://www.gentleware.com/">Poseidon</a>  (commercial, based on ArgoUML)</dt>
<dd>stores the model native as xmi + diagram information in .zargo files (zip files) (xmi version 1.2)</dd>
<dt><a href="http://www.kde.org/">KDE</a>'s <a href="http://www.umbrello.org/">Umbrello</a>  (free, not complete yet)</dt>
<dd>umbrello saves the models native in XMI (not fully standard compliant)</dd>
</dl>
</div>
<div class="section" id="installation">
<h2><a name="installation">Installation</a></h2>
<p>Requirements: You need an recent Archetypes with all it's dependencies (see Archetypes README), <a href="http://pyxml.sourceforge.net/">PyXML</a> and an UML-Tool.</p>
<p>It's tested with Plone 2.0 beta3 and Archetypes CVS HEAD too.</p>
<p>Install a UML-Tool on your local workstation. For our examples we used the ObjectDomain Evaluation Version.</p>
<p>Get latest ArchGenXML Release from CVS:</p>
<pre>
cvs -d :pserver:anonymous&#64;cvs.sf.net:/cvsroot/archetypes co ArchGenXML
</pre>
<p>See also README file in ArchGenXML!</p>
</div>
<div class="section" id="usage">
<h2><a name="usage">Usage</a></h2>
<p>The usage is:</p>
<pre>
python ArchGenXML.py -o &lt;target&gt; [ options ] &lt;xmi-source-file&gt;

OPTIONS:
  -o &lt;target&gt;
      Output file directory path for data  representation classes. Last part
      is used for internal directory namings.

  -P &lt;name1&gt;,&lt;name2&gt;...
      names of packages to parse in source file

  -a --actions
      generates actions (default)

  --no-actions
      do not generates actions

  --method-preservation
      methods in the target sources will be preserved (default)

  --no-method-preservation
      methods in the target sources will be preserved

  -t --unknown-types-as-string
      unknown attribute types will be treated as text

  --ape-support
      generate apeconf.xml and generators for ape (needs Archetypes 1.1+)

  --i18n-support
      support for i18NArchetypes. Attributes with a stereotype 'i18n' or a
      taggedValue 'i18n' set to '1' are multilingual.

  --creation-permission=&lt;perm&gt;
      specifies which permission to create content default:Add [project]
      content

  --detailled-creation-permissions
      seperate creation permissions per class

  --no-module-info-header
      do not generate module info header

  --author=&lt;string&gt;
      set default author string for module info headers, taggedValue will
      override this

  --e-mail=&lt;string&gt;
      set default e-mail adress string for module info headers, taggedValue
      will override this

  --copyright=&lt;string&gt;
      set default copyright string for module info headers, taggedValue will
      override this

  --licence=&lt;string&gt;
      set default licence string for module info-headers, taggedValue will
      override this
</pre>
<p>Example:</p>
<pre>
./ArchGenXML.py -o MyNewProduct mynewproduct.xmi
</pre>
</div>
<div class="section" id="first-simple-example">
<h2><a name="first-simple-example">First simple example</a></h2>
<p>First we start with a simple example describing how to generat your first simple
ArcheType out of an UML. Create a new class diagram. Create a new class.
Add some attributes.
No assigned value defaults to a string-field.
The example also has an image-field and field containing a floating-point number.</p>
<div>
<img alt="A simple UML example" src="figures/ExampleSimple.png" /></div>
<p>You can download this example here as <a href="samples/ArchGenSimpleExample.xmi">XMI-File</a> or <a href="samples/ArchGenSimpleExample.odm">ObjectDomain-File</a>.</p>
<p>Now export it to XMI or .zargo.</p>
<p>Start ArchGenXML generating python code:</p>
<pre>
./ArchGenXML.py -a yes -o ArchGenSimpleExample ArchGenSimpleExample.xmi
</pre>
<p>Now a folder exists containing the Product. Move or link this Folder to your zope-instance product directory.
Restart zope. Go to to the portal_quickinstaller tool and add the new Product ArchGenSimpleExample. Thats it.
Now you have a new content-type available to your Plone.</p>
</div>
</div>
<div class="section" id="archgenxml-cookbook">
<h1><a name="archgenxml-cookbook">ArchGenXML Cookbook</a></h1>
<p>A complex example using all ArchGenXML capabilities to show what is possible.</p>
<div class="section" id="overview">
<h2><a name="overview">Overview</a></h2>
<div>
<img alt="A more complex UML example" src="figures/ExampleComplexOverview.png" /></div>
<p>Here we have a simple project-management software. The Class Project</p>
</div>
<div class="section" id="explaining-class-project">
<h2><a name="explaining-class-project">Explaining Class <code>Project</code></a></h2>
<p>We have a class Project with a field (attribute) description with the Type Expression <code>text</code>.
It's rendered by default with the TextAreaWidget. But if you want to use Epoz,
VisualEditor or such nice stuff we have to change it to the VisualWidget.
Create a new tagged value called <code>widget</code> and give it the value <code>VisualWidget</code>.</p>
<div>
<img alt="Adding an attribute with it's custom widget." src="figures/ExampleComplexAttribute.png" /></div>
<p>We also define some operations. First a simple method: <code>countTasks</code>.
It contains its code as an tagged value <code>code</code>. You can add some <code>documentation</code> too.
It's written to the method code too.</p>
<div>
<img alt="Adding a method and code." src="figures/ExampleComplexOperationsCode.png" /></div>
<p>You can also define the parameters given to the method in UML:</p>
<div>
<img alt="Adding a method and its parameters." src="figures/ExampleComplexOperationsCodePara.png" /></div>
<p>Also it's possible to define views for the ArcheType. An <code>operation</code> having the <code>tagged value</code> <code>view</code> generates an action.</p>
<div>
<img alt="Adding a view." src="figures/ExampleComplexOperationsView.png" /></div>
</div>
<div class="section" id="inheritance">
<h2><a name="inheritance">Inheritance</a></h2>
<p>The Class <code>Resource</code> is marked as abstract and the Classes <code>Person</code>, <code>Room</code> are inherited from it.
It means <code>Resource</code> isn't an addable object. It is just used to inherit from.  Person and Room are getting a field <code>description</code>.</p>
<div>
<img alt="Mark as an abstract class." src="figures/ExampleComplexInheritanceAbstract.png" /></div>
<p>The arrows indicating the inheritance are placed by selecting the Generelization Tool and drag from <code>Person</code> or <code>Room</code> to <code>Resource</code> (see figure overview above).</p>
</div>
<div class="section" id="references">
<h2><a name="references">References</a></h2>
<p>By defining references you get a field to select a referenced class.
Referenced objects can be moved inside the site and references still working.</p>
</div>
<div class="section" id="multiplicity">
<h2><a name="multiplicity">Multiplicity</a></h2>
<p>You can define the Multiplicity of aggregated and referenced classes.</p>
<p>The following multiplicity is supported:</p>
<ul>
<li>0 .. N</li>
<li>1 .. 1</li>
<li>1 .. N</li>
</ul>
<p>N - N is not supported.</p>
</div>
</div>
<div class="section" id="archgenxml-reference">
<h1><a name="archgenxml-reference">ArchGenXML Reference</a></h1>
<div class="section" id="installation-procedure">
<h2><a name="installation-procedure">Installation Procedure</a></h2>
<p>Instead of editing 'Extensions/Install.py' you should place a new file 'AppInstall.py'.
Define one or both  methods out of 'install' and 'uninstall' and put you additional code in here.
They are called after the automatic installation process via 'CMFQuickInstallerTool' (or old school style: calling External methods).</p>
</div>
<div class="section" id="classes-in-general">
<h2><a name="classes-in-general">Classes in General</a></h2>
<div class="section" id="stereotypes">
<h3><a name="stereotypes">Stereotypes</a></h3>
<dl>
<dt>no stereotype defined</dt>
<dd>Generate a simple standard Archetype.</dd>
<dt>stub, odStub</dt>
<dd>Classes with one of this stereotypes are ignored in generation process.</dd>
<dt>portal_tool</dt>
<dd>If defined the Archetype behaves like a portal_tool.</dd>
</dl>
</div>
<div class="section" id="tagged-values">
<h3><a name="tagged-values">Tagged Values</a></h3>
<p>Tagged Values are used to add different behaviors to a class:</p>
<dl>
<dt>archetype_name</dt>
<dd>This name appears in the 'add new item' box.
Default to class name.</dd>
<dt>additional_parents</dt>
<dd>parent classes for the class, comma-delimited.</dd>
<dt>author</dt>
<dd>set author name for module header info. defaults to 'unknown'.
Default may be changed by command line parameter.</dd>
<dt>autoinstall</dt>
<dd>If set to '1' a portal_tool instance will be created while installing the Product.
Only in combination with stereotype 'portal_tool'.</dd>
<dt>base_actions</dt>
<dd>Defines an actions tuple. Normally only used to inherit tuples from base_class.
If you just want define own actions see section 'Methods/Operations/Actions of a Class'.</dd>
<dt>base_class</dt>
<dd>Defines the base-class for folderish or contentish classes.
If no aggregation to another class is defined it defaults to 'BaseContent' otherwise to 'Basefolder'.
If i18n-support is enabled this setting would be ignored and
in case of no aggregation to another class it defaults to 'i18nBaseContent' otherwise to 'i18nBaseFolder'.</dd>
<dt>base_schema</dt>
<dd>Defines an alternate base-schema for the class instead of 'BaseSchema' or 'I18NBaseSchema'.
Do not forget to import your schema (see imports).</dd>
<dt>class_header</dt>
<dd>Code in here appears in the header of the class.</dd>
<dt>configlet</dt>
<dd>If set to '1' the 'view' action of the portal_tool will be used as a configlet.
Defaults to '0'.
Only in combination with stereotype 'portal_tool' and tagged value autoinstall set.</dd>
<dt>configlet_condition</dt>
<dd>Conditon expression for configlet.
Defaults to empty string.
Only in combination with configlet.</dd>
<dt>configlet_description</dt>
<dd>Description of the configlet.
Defaults to 'ArchGenXML generated Configlet configlet_title in Tool classname'.
Only in combination with configlet.</dd>
<dt>configlet_icon</dt>
<dd>Icon used for configlet.
Defaults to 'plone_icon'.
Only in combination with configlet.</dd>
<dt>configlet_section</dt>
<dd>Section where configlet should appear. One out of 'Plone', 'Product' or 'Member'
Defaults to 'Product'.
Only in combination with configlet.</dd>
<dt>configlet_title</dt>
<dd>Title of portal_tool and configlet.
Defaults to the class name.
Only in combination with configlet.</dd>
<dt>configlet_view</dt>
<dd>View which is shown for configlet
Defaults to the '/'.
Only in combination with configlet.</dd>
<dt>content_icon</dt>
<dd>set image name used as icon for the content type.
Defaults to 'classname.gif' with classname as the replaced by the name of the class.
Affects fti.</dd>
<dt>copyright</dt>
<dd>set copyright message for module header info. defaults to 'unknown'.
Default may be changed by command line parameter.</dd>
<dt>default_actions</dt>
<dd>Generate default actions for this class.
Can be enabled globally via command line parameter too.
Is only neccessary for Archetypes versions less than 1.2!</dd>
<dt>email</dt>
<dd>set email-address for module header info. defaults to 'unknown'.
Default may be changed by command line parameter.</dd>
<dt>hide_actions</dt>
<dd>Modify fti and set 'visible=0' on actions listed here.
One action per line.
I.e. to disable 'properties'-tab put 'metadata' in here.
Does not work for global folder tabs (Plone specific). See tagged value 'hide_folder_tabs'</dd>
<dt>hide_folder_tabs</dt>
<dd>Default is to global show the defined folder tabs (plone specific). This is i.e. the tab 'contents'
Setting 'hide_folder_tabs=1' do not add this content-type to
'YOUR_SITE/portal_properties/site_properties' property 'use_folder_tabs' while installing.</dd>
<dt>immediate_view</dt>
<dd>Defines the immediate view in the fti. Defaults to 'base_view'.</dd>
<dt>imports</dt>
<dd>Additional import lines. Code in here appears in the header of the file.</dd>
<dt>licence</dt>
<dd>set licence for module header info. Defaults to 'GNU General Public Licence (GPL) Version 2 or later'.
Default may be changed by command line parameter.</dd>
<dt>marshaller</dt>
<dd>marshaller to be used within Schema.</dd>
</dl>
</div>
<div class="section" id="misc">
<h3><a name="misc">misc</a></h3>
<dl>
<dt>abstract</dt>
<dd>Setting 'abstract' to checked (true, 1): The class is not available as Plone Content.
Other classes can inherit from it.</dd>
</dl>
</div>
</div>
<div class="section" id="attributes-of-a-class">
<h2><a name="attributes-of-a-class">Attributes of a Class</a></h2>
<p>For tagged values starting with 'python:' the code after ':' is taken, otherwise a triple quoted string.</p>
<div class="section" id="id1">
<h3><a name="id1">Stereotypes</a></h3>
<dl>
<dt>i18n</dt>
<dd>Support for i18NArchetypes. Fields with stereotype i18n are multilingual.</dd>
</dl>
</div>
<div class="section" id="expressions">
<h3><a name="expressions">Expressions</a></h3>
<p>A list of all possible expressions for attributes and it's default settings.</p>
<dl>
<dt>string</dt>
<dd><ul class="first last">
<li>StringField</li>
<li>searchable=1</li>
</ul>
</dd>
<dt>text</dt>
<dd><ul class="first last">
<li>StringField</li>
<li>searchable=1</li>
<li>TextAreaWidget()</li>
</ul>
</dd>
<dt>integer</dt>
<dd><ul class="first last">
<li>IntegerField</li>
<li>searchable=1</li>
</ul>
</dd>
<dt>float</dt>
<dd><ul class="first last">
<li>FloatField</li>
<li>searchable=1</li>
</ul>
</dd>
<dt>boolean</dt>
<dd><ul class="first last">
<li>BooleanField</li>
<li>searchable=1</li>
</ul>
</dd>
<dt>lines</dt>
<dd><ul class="first last">
<li>LinesField</li>
<li>searchable=1</li>
</ul>
</dd>
<dt>date</dt>
<dd><ul class="first last">
<li>DateTimeField</li>
<li>searchable=1</li>
</ul>
</dd>
<dt>image</dt>
<dd><ul class="first last">
<li>ImageField</li>
<li>sizes={'small':(100,100),'medium':(200,200),'large':(600,600)}</li>
<li>AttributeStorage()</li>
</ul>
</dd>
<dt>file</dt>
<dd><ul class="first last">
<li>FileField</li>
<li>AttributeStorage()</li>
<li>FileWidget()</li>
</ul>
</dd>
<dt>lines</dt>
<dd><ul class="first last">
<li>LinesField</li>
<li>searchable=1</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="id2">
<h3><a name="id2">Tagged Values</a></h3>
<p>All tagged values of a attribute will be converted into extended attributes for the archetypes field;
i.e. you can define 'widget', 'storage', searchable, ... to overwrite defaults or set additional.</p>
<dl>
<dt>Use of tagged value 'widget':</dt>
<dd><ul class="first last">
<li>'widget' defines the whole widget.</li>
<li>'widget:KEY' defines one key added to the widget.</li>
<li>i.e. 'widget:label' with content 'python:'Name' or 'widget:description' with content 'Enter your name'.</li>
</ul>
</dd>
</dl>
<p>At tagged value i18n on an attribute have the same effect as stereotype i18n.</p>
</div>
</div>
<div class="section" id="methods-operations-actions-of-a-class">
<h2><a name="methods-operations-actions-of-a-class">Methods/Operations/Actions of a Class</a></h2>
<p>Methods are generated from UML-Code if you want that.
You can also generate over an existing Python-File and ArchGenXML will keep the code of existing methods untouched.</p>
<p>Actions are generated by default you can turn it off by running ArchGenXML with parameter --no-actions.
You can define all nessecary values via ArchGenXML.</p>
<div class="section" id="id3">
<h3><a name="id3">Stereotypes</a></h3>
<dl>
<dt>no stereotype defined</dt>
<dd>Generate a method.</dd>
<dt>action</dt>
<dd>Generate an general action.</dd>
<dt>view</dt>
<dd>Generate an action and copy empty page-template to skins directory named like the form + .pt if no such template exists.</dd>
<dt>form</dt>
<dd>Generate an action and copy empty form-controller template to skins directory named like the form + .cpt if no such template exists.</dd>
</dl>
</div>
<div class="section" id="parameters">
<h3><a name="parameters">Parameters</a></h3>
<p>Defines parameters of the method. Unused for action, view or form.</p>
<p>If 'action name' below is mentioned it is the name of the method with
stereotype action, view or form unless no tagged value 'action', 'view'
or 'form' is defined (depending on the stereotype).</p>
</div>
<div class="section" id="id4">
<h3><a name="id4">Tagged Values</a></h3>
<dl>
<dt>action</dt>
<dd>The action to be executed. Defaults to action name.</dd>
<dt>code</dt>
<dd>The python code-body of your method.</dd>
<dt>category</dt>
<dd>The category of an action, view or form. Defaults to 'object'.</dd>
<dt>documentation</dt>
<dd>The python doc-string of a method.</dd>
<dt>form</dt>
<dd>see action. an empty template with</dd>
<dt>id</dt>
<dd>The id of an action, view or form. Defaults to the action name.</dd>
<dt>label</dt>
<dd>The label of an action, view or form. Defaults to the action name.</dd>
<dt>permission</dt>
<dd><p class="first">Set permission for:</p>
<dl class="last">
<dt>method</dt>
<dd>permission='MY_PERMISSION' results in security.declareProtected('MY_PERMISSION','mymethodname')</dd>
<dt>action</dt>
<dd>permission='MY_PERMISSION' results in 'permissions': ('MY_PERMISSION',)</dd>
</dl>
</dd>
<dt>view</dt>
<dd>see action</dd>
</dl>
</div>
</div>
<div class="section" id="aggregation-between-two-classes">
<h2><a name="aggregation-between-two-classes">Aggregation between two classes</a></h2>
<p>By defining an aggregation your archetype will become folderish.
Only aggregated objects are allowed to residate in the folder.</p>
<p>There are two types of aggregation with different behaviors:</p>
<dl>
<dt>shared aggregation (empty rhomb)</dt>
<dd>aggregated objects are allowed to be added outside and inside the archetype</dd>
<dt>composite aggregation  (filled rhomb)</dt>
<dd>aggregated objects are only allowed to reside inside the archetype</dd>
</dl>
</div>
</div>
</div>

